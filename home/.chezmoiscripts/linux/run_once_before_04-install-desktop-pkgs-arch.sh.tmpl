#!/usr/bin/env bash
# Install desktop packages for Arch-based systems

# Import formatting library
source "{{ .chezmoi.sourceDir }}/utils-linux/formatting.sh"

{{ if and (eq .chezmoi.os "linux") (or (eq .chezmoi.osRelease.id "arch") (eq .chezmoi.osRelease.id "manjaro") (eq .chezmoi.osRelease.id "endeavouros")) .isDesktop -}}
# Only execute on Arch-based desktop systems

set -eufo pipefail

print_header "Arch Desktop Package Installation" "Installing desktop packages for Arch-based systems" "$ICON_PACKAGE"

print_section "System Update" "$ICON_UPDATE"
print_action "Updating" "system packages" "$ICON_UPDATE"
sudo pacman -Syu --noconfirm

print_section "Common Desktop Packages" "$ICON_PACKAGE"
print_action "Installing" "common desktop packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.common -}}
  {{ . }} \
  {{ end -}}

# Install desktop environment specific packages
{{ if eq .desktopEnv "gnome" -}}
print_section "GNOME Packages" "$ICON_CONFIG"
print_action "Installing" "GNOME-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.gnome -}}
  {{ . }} \
  {{ end -}}
{{ else if eq .desktopEnv "kde" -}}
print_section "KDE Packages" "$ICON_CONFIG"
print_action "Installing" "KDE-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.kde -}}
  {{ . }} \
  {{ end -}}
{{ else if eq .desktopEnv "xfce" -}}
print_section "Xfce Packages" "$ICON_CONFIG"
print_action "Installing" "Xfce-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.xfce -}}
  {{ . }} \
  {{ end -}}
{{ else if eq .desktopEnv "cinnamon" -}}
print_section "Cinnamon Packages" "$ICON_CONFIG"
print_action "Installing" "Cinnamon-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.cinnamon -}}
  {{ . }} \
  {{ end -}}
{{ else if eq .desktopEnv "mate" -}}
print_section "MATE Packages" "$ICON_CONFIG"
print_action "Installing" "MATE-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.mate -}}
  {{ . }} \
  {{ end -}}
{{ else if eq .desktopEnv "i3" -}}
print_section "i3 Packages" "$ICON_CONFIG"
print_action "Installing" "i3-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.i3 -}}
  {{ . }} \
  {{ end -}}
{{ else if eq .desktopEnv "sway" -}}
print_section "Sway Packages" "$ICON_CONFIG"
print_action "Installing" "Sway-specific packages" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.sway -}}
  {{ . }} \
  {{ end -}}
{{ end -}}

print_section "Desktop Themes" "$ICON_CONFIG"
print_action "Installing" "desktop themes" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.themes -}}
  {{ . }} \
  {{ end -}}

print_section "Additional Fonts" "$ICON_FONT"
print_action "Installing" "additional fonts" "$ICON_FONT"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.fonts -}}
  {{ . }} \
  {{ end -}}

print_section "Desktop Utilities" "$ICON_CONFIG"
print_action "Installing" "desktop utilities" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.utilities -}}
  {{ . }} \
  {{ end -}}

print_section "Multimedia Applications" "$ICON_PACKAGE"
print_action "Installing" "multimedia applications" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.multimedia -}}
  {{ . }} \
  {{ end -}}

print_section "Development Tools" "$ICON_PACKAGE"
print_action "Installing" "development tools" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.development -}}
  {{ . }} \
  {{ end -}}

print_section "Productivity Applications" "$ICON_PACKAGE"
print_action "Installing" "productivity applications" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.productivity -}}
  {{ . }} \
  {{ end -}}

print_section "Communication Applications" "$ICON_PACKAGE"
print_action "Installing" "communication applications" "$ICON_INSTALL"
sudo pacman -S --noconfirm \
  {{ range .pkgs.linuxDesktop.communication -}}
  {{ . }} \
  {{ end -}}

print_section "AUR Packages" "$ICON_PACKAGE"
# Check if yay is installed for AUR packages
if command -v yay &>/dev/null; then
    print_action "Installing" "AUR packages with yay" "$ICON_INSTALL"
    # Add AUR packages as needed
    # yay -S --noconfirm visual-studio-code-bin spotify
    print_success "AUR packages setup completed"
else
    print_warning "yay not found. Skipping AUR packages."
    print_info "To install AUR packages, install yay first."
fi

print_success "Desktop packages installation completed for Arch Linux!"
print_footer "Arch Desktop Package Installation" "completed"

{{ else }}
print_header "Arch Desktop Package Installation" "Skipping - not an Arch-based desktop system" "$ICON_PACKAGE"
print_warning "This script is designed for Arch-based desktop systems only"
print_footer "Arch Desktop Package Installation" "skipped"
{{ end -}}
